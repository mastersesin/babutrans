--Piaomiaofeng Zhuo Bufan AI--A [Jianmang] Use an empty skill...and then setdamage according to the sect....--B [Golden Armor] Use a buff skill for yourself....--C [Mirror] Use a buff skill for yourself....--D [Friend] When the injustice dies, use a buff skill for yourself....--The whole process has buffs that are immune to formulating skills....-- Use A on the current enemy every 40 seconds...-- Take turns using BC every 30 seconds....--Looking for the Injustice when dying....Setting it requires the use of violent skills....--When you die, you find that the Injustice is dead...and then create another BOSS....--script numberx402280_g_ScriptId	= 402280--Copy logic script number....x402280_g_FuBenScriptId = 402276--Immunity Buff....x402280_Buff_MianYi1	= 10472	-- Immune to some negative effects....x402280_Buff_MianYi2	= 10471	-- Immune to normal invisibility....--Skill....x402280_SkillID_A		= 1033x402280_SkillID_B		= 1034x402280_SkillID_C		= 1035x402280_SkillID_D		= 1036x402280_BuffID_D1		= 10253x402280_BuffID_D2		= 10254x402280_SkillCD_A		=	40000x402280_SkillCD_BC	=	30000x402280_SkillA_Damage =	--The simple version of Misty Peak uses a version with reduced damage....{	[0] = 23815/4,	[1] = 16570/4,	[2] = 18820/4,	[3] = 11978/4,	[4] = 13170/4,	[5] = 15610/4,	[6] = 14496/4,	[7] = 15240/4,	[8] = 14070/4,	[9] = 99999}x402280_BrotherName = "B¤t Bình ÐÕo Nhân"	--brother's name....--AI Index....x402280_IDX_KuangBaoMode	= 1	--Rage mode....0 is not berserk 1 needs to be berserk 2 has been berserkx402280_IDX_CurSkillIndex	= 2	--Which skill in BC should I use next....x402280_IDX_CD_SkillA			= 3	--A skill CD....x402280_IDX_CD_SkillBC		= 4	--CD of BC skills....x402280_IDX_CombatFlag 		= 1	--Whether it is a sign of combat status....--**********************************--initialization....--**********************************function x402280_OnInit(sceneId, selfId)	--Reset AI....	x402280_ResetMyAI( sceneId, selfId )end--**********************************--heartbeat....--**********************************function x402280_OnHeartBeat(sceneId, selfId, nTick)	-- Check if it is dead....	if LuaFnIsCharacterLiving(sceneId, selfId) ~= 1 then		return	end	-- Check if not in combat state....	if 0 == MonsterAI_GetBoolParamByIndex( sceneId, selfId, x402280_IDX_CombatFlag ) then		return	end	--A skill heartbeat....	if 1 == x402280_TickSkillA( sceneId, selfId, nTick ) then		return	end	--BC skill heartbeat....	if 1 == x402280_TickSkillBC( sceneId, selfId, nTick ) then		return	end	--D skill heartbeat....	if 1 == x402280_TickSkillD( sceneId, selfId, nTick ) then		return	endend--**********************************-- enter the battle....--**********************************function x402280_OnEnterCombat(sceneId, selfId, enmeyId)	--Add initial buff....	LuaFnSendSpecificImpactToUnit( sceneId, selfId, selfId, selfId, x402280_Buff_MianYi1, 0 )	LuaFnSendSpecificImpactToUnit( sceneId, selfId, selfId, selfId, x402280_Buff_MianYi2, 0 )	--Reset AI....	x402280_ResetMyAI( sceneId, selfId )	--Set to enter the combat state....	MonsterAI_SetBoolParamByIndex( sceneId, selfId, x402280_IDX_CombatFlag, 1 )end--**********************************--leave the fight....--**********************************function x402280_OnLeaveCombat(sceneId, selfId)	--Reset AI....	x402280_ResetMyAI( sceneId, selfId )	--Traverse all the monsters in the scene....find brothers and delete them....	local nMonsterNum = GetMonsterCount(sceneId)	for i=0, nMonsterNum-1 do		local MonsterId = GetMonsterObjID(sceneId,i)		if x402280_BrotherName == GetName( sceneId, MonsterId ) then			LuaFnDeleteMonster( sceneId, MonsterId )		end	end	--delete self....	LuaFnDeleteMonster( sceneId, selfId )end--**********************************-- kill enemies....--**********************************function x402280_OnKillCharacter(sceneId, selfId, targetId)end--**********************************--die....--**********************************function x402280_OnDie( sceneId, selfId, killerId )	--Reset AI....	x402280_ResetMyAI( sceneId, selfId )	local bFind = 0	--Traverse all the monsters in the scene...to find brothers...to set them to use berserk skills....	local nMonsterNum = GetMonsterCount(sceneId)	for i=0, nMonsterNum-1 do		local MonsterId = GetMonsterObjID(sceneId,i)		if x402280_BrotherName == GetName( sceneId, MonsterId ) and LuaFnIsCharacterLiving(sceneId, MonsterId) == 1 then			bFind = 1			MonsterAI_SetIntParamByIndex( sceneId, MonsterId, x402280_IDX_KuangBaoMode, 1 )		end	end	--If you don't find a brother, it means you are the only one left....	if 0 == bFind then		--Create Duanmu element....		local MstId = CallScriptFunction( x402280_g_FuBenScriptId, "CreateBOSS", sceneId, "DuanMuYuan_BOSS", -1, -1 )		LuaFnNpcChat(sceneId, MstId, 0, "#{PMF_20080521_18}")		--The setting has already challenged Gemini....		CallScriptFunction( x402280_g_FuBenScriptId, "SetBossBattleFlag", sceneId, "ShuangZi", 2 )	endend--**********************************--Reset AI....--**********************************function x402280_ResetMyAI( sceneId, selfId )	--reset parameters....	MonsterAI_SetIntParamByIndex( sceneId, selfId, x402280_IDX_KuangBaoMode, 0 )	MonsterAI_SetIntParamByIndex( sceneId, selfId, x402280_IDX_CurSkillIndex, 1 )	MonsterAI_SetIntParamByIndex( sceneId, selfId, x402280_IDX_CD_SkillA, x402280_SkillCD_A )	MonsterAI_SetIntParamByIndex( sceneId, selfId, x402280_IDX_CD_SkillBC, x402280_SkillCD_BC )	MonsterAI_SetBoolParamByIndex( sceneId, selfId, x402280_IDX_CombatFlag, 0 )end--**********************************--A skill heartbeat....--**********************************function x402280_TickSkillA( sceneId, selfId, nTick )	--Update skill CD....	local cd = MonsterAI_GetIntParamByIndex( sceneId, selfId, x402280_IDX_CD_SkillA )	if cd > nTick then		MonsterAI_SetIntParamByIndex( sceneId, selfId, x402280_IDX_CD_SkillA, cd-nTick )		return 0	else		MonsterAI_SetIntParamByIndex( sceneId, selfId, x402280_IDX_CD_SkillA, x402280_SkillCD_A-(nTick-cd) )		return x402280_UseSkillA( sceneId, selfId )	endend--**********************************--BC skill heartbeat....--**********************************function x402280_TickSkillBC( sceneId, selfId, nTick )	--Update skill CD....	local cd = MonsterAI_GetIntParamByIndex( sceneId, selfId, x402280_IDX_CD_SkillBC )	if cd > nTick then		MonsterAI_SetIntParamByIndex( sceneId, selfId, x402280_IDX_CD_SkillBC, cd-nTick )		return 0	else		MonsterAI_SetIntParamByIndex( sceneId, selfId, x402280_IDX_CD_SkillBC, x402280_SkillCD_BC-(nTick-cd) )		local CurSkill = MonsterAI_GetIntParamByIndex( sceneId, selfId, x402280_IDX_CurSkillIndex )		if CurSkill == 1 then			MonsterAI_SetIntParamByIndex( sceneId, selfId, x402280_IDX_CurSkillIndex, 2 )			return x402280_UseSkillB( sceneId, selfId )		elseif CurSkill == 2 then			MonsterAI_SetIntParamByIndex( sceneId, selfId, x402280_IDX_CurSkillIndex, 1 )			return x402280_UseSkillC( sceneId, selfId )		end	endend--**********************************--D skill heartbeat....--**********************************function x402280_TickSkillD( sceneId, selfId, nTick )	--Get current berserk mode....	local CurMode = MonsterAI_GetIntParamByIndex( sceneId, selfId, x402280_IDX_KuangBaoMode )	if CurMode == 0 or CurMode == 2 then		--Return if no berserk or already berserk....		return 0	elseif CurMode == 1 then		--Use the berserk skill if you need to be berserk....		local ret =  x402280_UseSkillD( sceneId, selfId )		if ret == 1 then			MonsterAI_SetIntParamByIndex( sceneId, selfId, x402280_IDX_KuangBaoMode, 2 )			return 1		else			return 0		end	endend--**********************************-- Use A skill....--**********************************function x402280_UseSkillA( sceneId, selfId )	-- get the current enemy....	local enemyId = GetMonsterCurEnemy( sceneId, selfId )	if enemyId <= 0 then		return 0	end	if GetCharacterType( sceneId, enemyId ) == 3 then		enemyId = GetPetCreator( sceneId, enemyId )	end	-- Use an empty skill....	local x,z = GetWorldPos( sceneId, enemyId )	LuaFnUnitUseSkill( sceneId, selfId, x402280_SkillID_A, enemyId, x, z, 0, 1 )	--According to the sect to deduct blood....	local MenPai = GetMenPai( sceneId, enemyId )	local Damage = x402280_SkillA_Damage[ MenPai ]	IncreaseHp( sceneId, enemyId, -Damage )	-- Shout out....	MonsterTalk( sceneId, -1, "", "#{PMF_20080530_18}"..GetName(sceneId,enemyId).."#{PMF_20080530_19}" )	return 1end--**********************************-- Use B skill....--**********************************function x402280_UseSkillB( sceneId, selfId )	local x,z = GetWorldPos( sceneId, selfId )	LuaFnUnitUseSkill( sceneId, selfId, x402280_SkillID_B, selfId, x, z, 0, 1 )	MonsterTalk( sceneId, -1, "", "#{PMF_20080530_20}" )	return 1end--**********************************-- Use C skills....--**********************************function x402280_UseSkillC( sceneId, selfId )	local x,z = GetWorldPos( sceneId, selfId )	LuaFnUnitUseSkill( sceneId, selfId, x402280_SkillID_C, selfId, x, z, 0, 1 )	MonsterTalk( sceneId, -1, "", "#{PMF_20080530_21}" )	return 1end--**********************************-- Use D skills....--**********************************function x402280_UseSkillD( sceneId, selfId )	LuaFnSendSpecificImpactToUnit( sceneId, selfId, selfId, selfId, x402280_BuffID_D1, 5000 )	LuaFnSendSpecificImpactToUnit( sceneId, selfId, selfId, selfId, x402280_BuffID_D2, 5000 )	local x,z = GetWorldPos( sceneId, selfId )	LuaFnUnitUseSkill( sceneId, selfId, x402280_SkillID_D, selfId, x, z, 0, 1 )	MonsterTalk( sceneId, -1, "", "#{PMF_20080530_22}" )	return 1end