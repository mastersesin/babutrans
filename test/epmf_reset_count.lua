--Reset the number of challenges in the Misty Peak dungeon....--! ! ! Notice! ! !--The number of resets and the date are saved using an INT....--The lower 2 bits of INT indicate the number of times...so it only supports a maximum of 99 resets per day....--However, since the number of items consumed each time is twice that of the last time...so the number needed for the 99th time is astronomical...2^99--script numberx402289_g_ScriptId = 402289--**********************************--Task entry function....--**********************************function x402289_OnDefaultEvent( sceneId, selfId, targetId )	local NumText = GetNumText()	if NumText == 1	then		x402289_CheckCanReset( sceneId, selfId, targetId )	elseif NumText == 2	then		BeginEvent(sceneId)			AddText(sceneId,"#{XPMCZ_81106_6}")		EndEvent(sceneId)		DispatchEventList(sceneId,selfId,targetId)	elseif NumText == 3	then		x402289_ResetPMFCount( sceneId, selfId, targetId )	elseif NumText == 4	then		BeginUICommand(sceneId)		EndUICommand(sceneId)		DispatchUICommand(sceneId,selfId, 1000)	endend--**********************************-- list events--**********************************function x402289_OnEnumerate( sceneId, selfId, targetId )	AddNumText( sceneId, x402289_g_ScriptId, "#{INTERFACE_XML_1183}", 9, 1 )	AddNumText( sceneId, x402289_g_ScriptId, "#{INTERFACE_XML_1184}", 11, 2 )end--**********************************--Determine whether you can fight Misty Peak again....--**********************************function x402289_CheckCanReset( sceneId, selfId, targetId )	-- Obtain the number of times Xiao Mimiao challenged today....	local CurDayTime = GetDayTime()	local lastTime = GetMissionData( sceneId, selfId, MD_PIAOMIAOFENG_SMALL_LASTTIME )	local lastDayTime = floor( lastTime / 100 )	local lastDayCount = mod( lastTime, 100 )	if CurDayTime > lastDayTime then		lastDayTime = CurDayTime		lastDayCount = 0	end	--If you haven't challenged Misty Peak yet...you don't need to reset the number....	if lastDayCount <= 0 then		BeginEvent(sceneId)			AddText(sceneId,"#{XPMCZ_81106_1}")		EndEvent(sceneId)		DispatchEventList(sceneId,selfId,targetId)		return	end	--Get the number of reset challenge times today....	local lastTime2 = GetMissionData( sceneId, selfId, MD_RESET_PMFSMALL_COUNT_LASTTIME )	local lastDayTime2 = floor( lastTime2 / 100 )	local lastDayCount2 = mod( lastTime2, 100 )	if CurDayTime > lastDayTime2 then		lastDayTime2 = CurDayTime		lastDayCount2 = 0	end	--Second level confirmation menu....	local NeedNum = 2^lastDayCount2	local NeedNum2 = 2^(lastDayCount2+1)	BeginEvent(sceneId)		AddText( sceneId, "#{CZPMF_90212_1}"..NeedNum.."#{CZPMF_90212_2}"..NeedNum2.."#{CZPMF_90212_3}" )		AddNumText( sceneId, x402289_g_ScriptId, "Xác nh§n", 8, 3 )		AddNumText( sceneId, x402289_g_ScriptId, "Hüy bö", 8, 4 )	EndEvent(sceneId)	DispatchEventList(sceneId,selfId,targetId)end--**********************************--Reset the number of challenges in Misty Peak....--**********************************function x402289_ResetPMFCount( sceneId, selfId, targetId )	-- Obtain the number of times Xiao Mimiao challenged today....	local CurDayTime = GetDayTime()	local lastTime = GetMissionData( sceneId, selfId, MD_PIAOMIAOFENG_SMALL_LASTTIME )	local lastDayTime = floor( lastTime / 100 )	local lastDayCount = mod( lastTime, 100 )	if CurDayTime > lastDayTime then		lastDayTime = CurDayTime		lastDayCount = 0	end	--If you haven't challenged Misty Peak yet...you don't need to reset the number....	if lastDayCount <= 0 then		return	end	--Get the number of reset challenge times today....	local lastTime2 = GetMissionData( sceneId, selfId, MD_RESET_PMFSMALL_COUNT_LASTTIME )	local lastDayTime2 = floor( lastTime2 / 100 )	local lastDayCount2 = mod( lastTime2, 100 )	if CurDayTime > lastDayTime2 then		lastDayTime2 = CurDayTime		lastDayCount2 = 0	end	-- Are there enough items....	local NeedNum = 2^lastDayCount2	if LuaFnGetAvailableItemCount( sceneId, selfId, 30501170 ) < NeedNum then		BeginEvent(sceneId)			AddText(sceneId,"#{XPMCZ_81106_4}")		EndEvent(sceneId)		DispatchEventList(sceneId,selfId,targetId)		return	end	-- Buckle items....	if 1 ~= LuaFnDelAvailableItem(sceneId, selfId, 30501170, NeedNum ) then		return	end	--Reset the number of challenges in Misty Peak....	lastTime = lastDayTime * 100 + 0 --lastDayCount	SetMissionData( sceneId, selfId, MD_PIAOMIAOFENG_SMALL_LASTTIME, lastTime )	--Set the number of resets today....	lastDayCount2 = lastDayCount2 + 1	lastTime2 = lastDayTime2 * 100 + lastDayCount2	SetMissionData( sceneId, selfId, MD_RESET_PMFSMALL_COUNT_LASTTIME, lastTime2 )	--statistics....	LuaFnAuditResetPMFCountSmall( sceneId, selfId, lastDayCount2 )	--Congratulations, you can go again....	BeginEvent(sceneId)		AddText(sceneId,"#{XPMCZ_81106_5}")	EndEvent(sceneId)	DispatchEventList(sceneId,selfId,targetId)end