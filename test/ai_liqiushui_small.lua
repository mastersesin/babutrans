--Piao Miaofeng Li Qiushui AI--A [Small Wuxiang Gong] Use an empty skill for yourself...and blind a random player....--B [Sword Dance] Use an empty skill for yourself....In the next 15s, add damage buffs to all players in the dungeon that gradually increase the damage value....--C [Free and easy] Use a buff-clearing skill for yourself....--D [Ice Burst] Use an empty skill for yourself...and then randomly place a trap under the player's feet....--E [Frenzy] Add a crazy buff to yourself...no longer use other skills....--The whole process has buffs that are immune to formulating skills....--At the beginning of the battle, use A skill every 10 seconds....--Use skill B when HP drops to 66% and 33% respectively...during the duration of skill B...don't use other skills when their CD is up....-- Use C skill every 20 seconds....-- Use D skill every 20 seconds....--script numberx402282_g_ScriptId	= 402282--Copy logic script number....x402282_g_FuBenScriptId = 402276--Immune to specific skill buff....x402282_Buff_MianYi1	= 10472	-- Immune to some negative effects....x402282_Buff_MianYi2	= 10471	-- Immune to normal invisibility....--A small formless skill....x402282_SkillA_ID			= 1042x402282_SkillA_Buff		=	10271x402282_SkillA_CD			= 10000--B sword dance....x402282_SkillB_SkillIDTbl = { 1043, 1044, 1045, 1046, 1047, 1048 }x402282_SkillB_WeatherTbl = { 11, 12, 13, 14, 15, 16 }x402282_SkillB_TalkTbl ={	"#{PMF_20080530_10}",	"#{PMF_20080530_11}",	"#{PMF_20080530_12}",	"#{PMF_20080530_13}",	"#{PMF_20080530_14}",	"#{PMF_20080530_15}"}x402282_SkillB_Text ={	"#{PMFTS_80917_5}",	"#{PMFTS_80917_3}",	"#{PMFTS_80917_6}",	"#{PMFTS_80917_1}",	"#{PMFTS_80917_2}",	"#{PMFTS_80917_4}"}x402282_SkillB_BuffIDTbl =	--The simple version of Misty Peak uses a version with reduced damage....{	[1] = {19808,19809,19810,19811,19812,19813,19814,19815,19816,19817,19818,19819,19820,19821,19822},	[2] = {19823,19824,19825,19826,19827,19828,19829,19830,19831,19832,19833,19834,19835,19836,19837},	[3] = {19838,19839,19840,19841,19842,19843,19844,19845,19846,19847,19848,19849,19850,19851,19852},	[4] = {19853,19854,19855,19856,19857,19858,19859,19860,19861,19862,19863,19864,19865,19866,19867},	[5] = {19868,19869,19870,19871,19872,19873,19874,19875,19876,19877,19878,19879,19880,19881,19882},	[6] = {19883,19884,19885,19886,19887,19888,19889,19890,19891,19892,19893,19894,19895,19896,19897}}--C free and easy....x402282_SkillC_ID		= 1049x402282_SkillC_CD		= 20000--D ice burst....x402282_SkillD_ID		= 1050x402282_SkillD_CD		= 20000x402282_SkillD_SpecObj = 73	--The simple version of Misty Peak uses a version with reduced damage....--E Berserk....x402282_SkillE_Buff1	= 10234x402282_SkillE_Buff2	= 10235--Time to start going berserk....x402282_EnterKuangBaoTime	= 10*60*1000--AI Index....x402282_IDX_StopWatch						= 1	--stopwatch....x402282_IDX_SkillA_CD						= 2	--CD time of skill A....x402282_IDX_SkillB_HPStep				= 3	--Health level....x402282_IDX_SkillB_Step					= 4	--Step of skill B....0=not activated 15=buff1 14=buff2 ...1=buff15x402282_IDX_SkillB_Type					= 5	--What type of sword dance is currently being used....x402282_IDX_SkillC_CD						= 6	--CD time of skill C....x402282_IDX_SkillD_CD						= 7	--CD time of skill C....x402282_IDX_KuangBaoTimer				= 8	--Rampage Timer....x402282_IDX_CombatFlag 			= 1	--Whether it is a sign of combat status....x402282_IDX_IsKuangBaoMode	= 2	-- flag for berserk mode....--**********************************--initialization....--**********************************function x402282_OnInit(sceneId, selfId)	--Reset AI....	x402282_ResetMyAI( sceneId, selfId )end--**********************************--heartbeat....--**********************************function x402282_OnHeartBeat(sceneId, selfId, nTick)	-- Check if it is dead....	if LuaFnIsCharacterLiving(sceneId, selfId) ~= 1 then		return	end	-- Check if not in combat state....	if 0 == MonsterAI_GetBoolParamByIndex( sceneId, selfId, x402282_IDX_CombatFlag ) then		return	end	--Rage state does not need logic....	if 1 == MonsterAI_GetBoolParamByIndex( sceneId, selfId, x402282_IDX_IsKuangBaoMode ) then		return	end	--A skill heartbeat....	if 1 == x402282_TickSkillA( sceneId, selfId, nTick ) then		return	end	--B skill heartbeat....	if 1 == x402282_TickSkillB( sceneId, selfId, nTick ) then		return	end	--C skill heartbeat....	if 1 == x402282_TickSkillC( sceneId, selfId, nTick ) then		return	end	--D skill heartbeat....	if 1 == x402282_TickSkillD( sceneId, selfId, nTick ) then		return	end	--E skill heartbeat....	if 1 == x402282_TickSkillE( sceneId, selfId, nTick ) then		return	end	--stopwatch heartbeat....	x402282_TickStopWatch( sceneId, selfId, nTick )end--**********************************-- enter the battle....--**********************************function x402282_OnEnterCombat(sceneId, selfId, enmeyId)	--Add initial buff....	LuaFnSendSpecificImpactToUnit( sceneId, selfId, selfId, selfId, x402282_Buff_MianYi1, 0 )	LuaFnSendSpecificImpactToUnit( sceneId, selfId, selfId, selfId, x402282_Buff_MianYi2, 0 )	--Reset AI....	x402282_ResetMyAI( sceneId, selfId )	--Set to enter the combat state....	MonsterAI_SetBoolParamByIndex( sceneId, selfId, x402282_IDX_CombatFlag, 1 )end--**********************************--leave the fight....--**********************************function x402282_OnLeaveCombat(sceneId, selfId)	--Reset AI....	x402282_ResetMyAI( sceneId, selfId )	--delete self....	LuaFnDeleteMonster( sceneId, selfId )end--**********************************-- kill enemies....--**********************************function x402282_OnKillCharacter(sceneId, selfId, targetId)end--**********************************--die....--**********************************function x402282_OnDie( sceneId, selfId, killerId )	--Reset AI....	x402282_ResetMyAI( sceneId, selfId )	--Settings have already challenged Li Qiushui....	CallScriptFunction( x402282_g_FuBenScriptId, "SetBossBattleFlag", sceneId, "LiQiuShui", 2 )	-- zchw global announcement	local	playerName	= GetName( sceneId, killerId )		--The one who kills the monster is a pet, then get the name of its owner....	local playerID = killerId	local objType = GetCharacterType( sceneId, killerId )	if objType == 3 then		playerID = GetPetCreator( sceneId, killerId )		playerName = GetName( sceneId, playerID )	end		--If the player is in a team, get the captain's name....	local leaderID = GetTeamLeader( sceneId, playerID )	if leaderID ~= -1 then		playerName = GetName( sceneId, leaderID )	end		if playerName ~= nil then		str = format("#{XPM_8724_7}#{_INFOUSR%s}#{XPM_8724_8}", playerName);   --Li Qiushui		AddGlobalCountNews( sceneId, str )	endend--**********************************--Reset AI....--**********************************function x402282_ResetMyAI( sceneId, selfId )	--reset parameters....	MonsterAI_SetIntParamByIndex( sceneId, selfId, x402282_IDX_StopWatch, 0 )	MonsterAI_SetIntParamByIndex( sceneId, selfId, x402282_IDX_SkillA_CD, 0 )	MonsterAI_SetIntParamByIndex( sceneId, selfId, x402282_IDX_SkillB_HPStep, 0 )	MonsterAI_SetIntParamByIndex( sceneId, selfId, x402282_IDX_SkillB_Step, 0 )	MonsterAI_SetIntParamByIndex( sceneId, selfId, x402282_IDX_SkillB_Type, 1 )	MonsterAI_SetIntParamByIndex( sceneId, selfId, x402282_IDX_SkillC_CD, x402282_SkillC_CD )	MonsterAI_SetIntParamByIndex( sceneId, selfId, x402282_IDX_SkillD_CD, x402282_SkillD_CD )	MonsterAI_SetIntParamByIndex( sceneId, selfId, x402282_IDX_KuangBaoTimer, 0 )	MonsterAI_SetBoolParamByIndex( sceneId, selfId, x402282_IDX_CombatFlag, 0 )	MonsterAI_SetBoolParamByIndex( sceneId, selfId, x402282_IDX_IsKuangBaoMode, 0 )end--**********************************--A skill heartbeat....--**********************************function x402282_TickSkillA( sceneId, selfId, nTick )	--Update skill CD....	local cd = MonsterAI_GetIntParamByIndex( sceneId, selfId, x402282_IDX_SkillA_CD )	if cd > nTick then		MonsterAI_SetIntParamByIndex( sceneId, selfId, x402282_IDX_SkillA_CD, cd-nTick )		return 0	else		MonsterAI_SetIntParamByIndex( sceneId, selfId, x402282_IDX_SkillA_CD, x402282_SkillA_CD-(nTick-cd) )		return x402282_UseSkillA( sceneId, selfId )	endend--**********************************--B skill heartbeat....--**********************************function x402282_TickSkillB( sceneId, selfId, nTick )	local CurPercent = GetHp( sceneId, selfId ) / GetMaxHp( sceneId, selfId )	local LastStep = MonsterAI_GetIntParamByIndex( sceneId, selfId, x402282_IDX_SkillB_HPStep )	local CurStep = 0	if CurPercent <= 0.3333 then		CurStep = 2	elseif CurPercent <= 0.6666 then		CurStep = 1	end	if CurStep > LastStep then		--Setting parameters....		MonsterAI_SetIntParamByIndex( sceneId, selfId, x402282_IDX_SkillB_HPStep, CurStep )		MonsterAI_SetIntParamByIndex( sceneId, selfId, x402282_IDX_SkillB_Step, 15 )		local JianWuType = random( getn(x402282_SkillB_SkillIDTbl) )		MonsterAI_SetIntParamByIndex( sceneId, selfId, x402282_IDX_SkillB_Type, JianWuType )		-- Shout out....		MonsterTalk(sceneId, -1, "", x402282_SkillB_TalkTbl[JianWuType] )		MonsterTalk(sceneId, -1, "", x402282_SkillB_Text[JianWuType] )		--Fireworks for the whole scene....		LuaFnSetSceneWeather(sceneId, x402282_SkillB_WeatherTbl[JianWuType], 15000 )		-- Use empty skills on yourself....		local x,z = GetWorldPos( sceneId, selfId )		LuaFnUnitUseSkill( sceneId, selfId, x402282_SkillB_SkillIDTbl[JianWuType], selfId, x, z, 0, 1 )		return 1	end	return 0end--**********************************--C skill heartbeat....--**********************************function x402282_TickSkillC( sceneId, selfId, nTick )	--Update skill CD....	local cd = MonsterAI_GetIntParamByIndex( sceneId, selfId, x402282_IDX_SkillC_CD )	if cd > nTick then		MonsterAI_SetIntParamByIndex( sceneId, selfId, x402282_IDX_SkillC_CD, cd-nTick )		return 0	else		MonsterAI_SetIntParamByIndex( sceneId, selfId, x402282_IDX_SkillC_CD, x402282_SkillC_CD-(nTick-cd) )		return x402282_UseSkillC( sceneId, selfId )	endend--**********************************--D skill heartbeat....--**********************************function x402282_TickSkillD( sceneId, selfId, nTick )	--Update skill CD....	local cd = MonsterAI_GetIntParamByIndex( sceneId, selfId, x402282_IDX_SkillD_CD )	if cd > nTick then		MonsterAI_SetIntParamByIndex( sceneId, selfId, x402282_IDX_SkillD_CD, cd-nTick )		return 0	else		MonsterAI_SetIntParamByIndex( sceneId, selfId, x402282_IDX_SkillD_CD, x402282_SkillD_CD-(nTick-cd) )		return x402282_UseSkillD( sceneId, selfId )	endend--**********************************--E skill heartbeat....--**********************************function x402282_TickSkillE( sceneId, selfId, nTick )	--If you are using B skills, wait first....	if MonsterAI_GetIntParamByIndex( sceneId, selfId, x402282_IDX_SkillB_Step ) > 0 then		return 0	end	-- Check if it's time to go berserk....	local kbTime = MonsterAI_GetIntParamByIndex( sceneId, selfId, x402282_IDX_KuangBaoTimer )	if kbTime < x402282_EnterKuangBaoTime then		MonsterAI_SetIntParamByIndex( sceneId, selfId, x402282_IDX_KuangBaoTimer, kbTime+nTick )		return 0	else		MonsterAI_SetBoolParamByIndex( sceneId, selfId, x402282_IDX_IsKuangBaoMode, 1 )		LuaFnSendSpecificImpactToUnit( sceneId, selfId, selfId, selfId, x402282_SkillE_Buff1, 0 )		LuaFnSendSpecificImpactToUnit( sceneId, selfId, selfId, selfId, x402282_SkillE_Buff2, 0 )		return 1	endend--**********************************--stopwatch heartbeat....--**********************************function x402282_TickStopWatch( sceneId, selfId, nTick )	--limit will only be executed once per second....	local time = MonsterAI_GetIntParamByIndex( sceneId, selfId, x402282_IDX_StopWatch )	if (time + nTick) > 1000 then		MonsterAI_SetIntParamByIndex( sceneId, selfId, x402282_IDX_StopWatch, time+nTick-1000 )	else		MonsterAI_SetIntParamByIndex( sceneId, selfId, x402282_IDX_StopWatch, time+nTick )		return	end	-------------------------	--Sword dance skill logic....	-------------------------	local buffStep = MonsterAI_GetIntParamByIndex( sceneId, selfId, x402282_IDX_SkillB_Step )	local skillType = MonsterAI_GetIntParamByIndex( sceneId, selfId, x402282_IDX_SkillB_Type )	if buffStep >= 1 and buffStep <= 15 then		--Looking for Fu Minyi....		local bossId = CallScriptFunction( x402282_g_FuBenScriptId, "FindBOSS", sceneId, "FuMinYi_NPC" )		if bossId <= 0 then			return 0		end		--Let Fu Minyi add buffs to players....		local buffTbl = x402282_SkillB_BuffIDTbl[skillType]		local buffId = buffTbl[16-buffStep]		local nHumanCount = LuaFnGetCopyScene_HumanCount(sceneId)		for i=0, nHumanCount-1 do			local nHumanId = LuaFnGetCopyScene_HumanObjId(sceneId, i)			if LuaFnIsObjValid(sceneId, nHumanId) == 1 and LuaFnIsCanDoScriptLogic(sceneId, nHumanId) == 1 and LuaFnIsCharacterLiving(sceneId, nHumanId) == 1 then				LuaFnSendSpecificImpactToUnit( sceneId, bossId, bossId, nHumanId, buffId, 0 )			end		end	end	if buffStep > 0 then		MonsterAI_SetIntParamByIndex( sceneId, selfId, x402282_IDX_SkillB_Step, buffStep-1 )	endend--**********************************-- Use A skill....--**********************************function x402282_UseSkillA( sceneId, selfId )	--Skip if B skill is being used....	if MonsterAI_GetIntParamByIndex( sceneId, selfId, x402282_IDX_SkillB_Step ) > 0 then		return 0	end	-- List of active players in the instance....	local PlayerList = {}	-- Add valid people to the list....	local numPlayer = 0	local nHumanCount = LuaFnGetCopyScene_HumanCount(sceneId)	for i=0, nHumanCount-1 do		local nHumanId = LuaFnGetCopyScene_HumanObjId(sceneId, i)		if LuaFnIsObjValid(sceneId, nHumanId) == 1 and LuaFnIsCanDoScriptLogic(sceneId, nHumanId) == 1 and LuaFnIsCharacterLiving(sceneId, nHumanId) == 1 then			PlayerList[numPlayer+1] = nHumanId			numPlayer = numPlayer + 1		end	end	-- Randomly pick a player....	if numPlayer <= 0 then		return 0	end	local PlayerId = PlayerList[ random(numPlayer) ]	-- Use an empty skill on yourself....	local x,z = GetWorldPos( sceneId, selfId )	LuaFnUnitUseSkill( sceneId, selfId, x402282_SkillA_ID, selfId, x, z, 0, 1 )	--Add blindness buff to the player....	LuaFnSendSpecificImpactToUnit( sceneId, selfId, selfId, PlayerId, x402282_SkillA_Buff, 0 )	return 1end--**********************************-- Use C skills....--**********************************function x402282_UseSkillC( sceneId, selfId )	--Skip if B skill is being used....	if MonsterAI_GetIntParamByIndex( sceneId, selfId, x402282_IDX_SkillB_Step ) > 0 then		return 0	end	local x,z = GetWorldPos( sceneId, selfId )	LuaFnUnitUseSkill( sceneId, selfId, x402282_SkillC_ID, selfId, x, z, 0, 1 )	return 1end--**********************************-- Use D skills....--**********************************function x402282_UseSkillD( sceneId, selfId )	--Skip if B skill is being used....	if MonsterAI_GetIntParamByIndex( sceneId, selfId, x402282_IDX_SkillB_Step ) > 0 then		return 0	end	-- List of active players in the instance....	local PlayerList = {}	-- Add valid people to the list....	local numPlayer = 0	local nHumanCount = LuaFnGetCopyScene_HumanCount(sceneId)	for i=0, nHumanCount-1 do		local nHumanId = LuaFnGetCopyScene_HumanObjId(sceneId, i)		if LuaFnIsObjValid(sceneId, nHumanId) == 1 and LuaFnIsCanDoScriptLogic(sceneId, nHumanId) == 1 and LuaFnIsCharacterLiving(sceneId, nHumanId) == 1 then			PlayerList[numPlayer+1] = nHumanId			numPlayer = numPlayer + 1		end	end	-- Randomly pick a player....	if numPlayer <= 0 then		return 0	end	local PlayerId = PlayerList[ random(numPlayer) ]	-- Use empty skills....	local x,z = GetWorldPos( sceneId, selfId )	LuaFnUnitUseSkill( sceneId, selfId, x402282_SkillD_ID, selfId, x, z, 0, 1 )	--Put a trap under the player's feet....	x,z = GetWorldPos( sceneId, PlayerId )	CreateSpecialObjByDataIndex(sceneId, selfId, x402282_SkillD_SpecObj, x, z, 0)	return 1end